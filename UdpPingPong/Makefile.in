EXTRA_CFLAGS = 
INCLUDE	= -I. -Iinclude -I../CommonLib/include -I../ppl7/include

CFLAGS		=  -ggdb -O2 -Wall  $(INCLUDE) @CFLAGS@ @DEFS@  @PTHREAD_CFLAGS@ \
	@ZLIB_CFLAGS@ @BZ2_CFLAGS@ @PCRE_CFLAGS@ @OPENSSL_INCLUDES@ @ICONV_CFLAGS@  \
	$(EXTRA_CFLAGS)


LIBS = ../ppl7/release/libppl7.a @OPENSSL_LDFLAGS@ @OPENSSL_LIBS@ @LIBS@ @PTHREAD_CFLAGS@ @PTHREAD_LIBS@ \
	@ZLIB_LIBS@ @BZ2_LIBS@ @PCRE_LIBS@ @ICONV_LIBS@  -lrt -lstdc++

LIBDEP = ../ppl7/release/libppl7.a



UNAME := $(shell uname)
ifeq "$(UNAME)" "FreeBSD"
LIBS += -lkvm
endif


all: pingpong_sender pingpong_bouncer

pingpong_sender: build/sender.o Makefile $(LIBDEP) ../CommonLib/build/libdnsperftest.a
	$(CXX) -O -o pingpong_sender $(CFLAGS) build/sender.o  ../CommonLib/build/libdnsperftest.a $(LIBS)

pingpong_bouncer: build/bouncer.o Makefile $(LIBDEP) ../CommonLib/build/libdnsperftest.a
	$(CXX) -O -o pingpong_bouncer $(CFLAGS) build/bouncer.o  ../CommonLib/build/libdnsperftest.a $(LIBS)


build/sender.o: src/sender.cpp Makefile ../CommonLib/include/udpecho.h
	mkdir -p build
	$(CXX) $(CFLAGS) -o build/sender.o -c src/sender.cpp

build/bouncer.o: src/bouncer.cpp Makefile ../CommonLib/include/udpecho.h
	mkdir -p build
	$(CXX) $(CFLAGS) -o build/bouncer.o -c src/bouncer.cpp


clean:
	-rm -rf build dnsperftest
